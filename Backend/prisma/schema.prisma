// Prisma schema
// https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

/* =========================
   MODELS
   ========================= */

model Dealer {
  id        String   @id @default(uuid())
  name      String
  location  String
  phone     String?
  email     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())

  // Relations
  users User[]
  cars  Car[]
  deals Deal[]
}

model User {
  id        String   @id @default(uuid())
  firstName String
  lastName  String
  email     String   @unique
  phone     String?
  password  String
  role      Role

  dealerId  String
  dealer    Dealer  @relation(fields: [dealerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())

  // Relations
  deals Deal[]
}

model Car {
  id           String   @id @default(uuid())
  make         String
  model        String
  year         Int
  price        Int
  mileage      Int      @default(0)
  owners       Int      @default(0)

  description  String?
  dealerNotes  String?
  registration String?
  recon        String?

  engineSize   Int?
  engineType   EngineType
  transmission TransmissionType @default(AUTOMATIC)
  color        ColorOptions

  condition    CarCondition   @default(NEW)
  type         CarType        @default(RETAIL)
  status       CarStatus      @default(DUE_IN)

  buyInDate    DateTime?
  buyInPrice   Int
  saleDate     DateTime?
  salePrice    Int?

  pictures     String[]
  video        String?

  dealerId     String
  dealer       Dealer   @relation(fields: [dealerId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt @default(now())

  // Relations
  car Deal[] @relation("Car")
  tradeIn Deal[] @relation("TradeIn")
}

model Deal {
  id String @id @default(uuid())

  /* Relations */
  dealerId      String
  dealer        Dealer @relation(fields: [dealerId], references: [id])

  carId         String
  car           Car    @relation("Car", fields: [carId], references: [id])

  salespersonId String
  salesperson   User   @relation(fields: [salespersonId], references: [id])

  tradeInId     String?
  tradeIn       Car?   @relation("TradeIn", fields: [tradeInId], references: [id])

  /* Deal info */
  agreedPrice   Int 
  status        DealStatus 
  dealDate      DateTime @default(now())
  pickupDate    DateTime?
  deposit       Int
  balance       Int
  tradeInAllowance Int?

  /* Finance */
  finance        Boolean       @default(false)
  financeStatus  FinanceStatus? @default(NOT_APPLIED)
  financeAmount  Int? @default(0)
  financeTerm    Int? @default(0)
  financeRate    Int? @default(0)

  /* Customer */
  customerFirstName String
  customerLastName  String
  customerEmail     String
  customerNumber    String

  /* Add-ons */
  gap                   Boolean @default(false)
  gapAmount             Int? @default(0)

  paintProtection       Boolean @default(false)
  paintProtectionAmount Int? @default(0)

  servicePlan           Boolean @default(false)
  servicePlanAmount     Int? @default(0)

  extendedWarranty       Boolean @default(false)
  extendedWarrantyAmount Int? @default(0)

  /* Metadata */
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())

  @@index([dealerId])
  @@index([carId])
}

/* =========================
   ENUMS
   ========================= */

enum Role {
  APPLICATION_ADMIN
  DEALER_ADMIN
  SALES_MANAGER
  SALESPERSON
}

enum DealStatus {
  AWAITING_PAYMENT
  AWAITING_PICKUP
  CANCELLED
  COLLECTED
  RETURNED
}

enum FinanceStatus {
  NOT_APPLIED
  AWAITING_APPROVAL
  APPROVED
  DECLINED
  AWAITING_PAYMENT
  PAID
}

enum CarStatus {
  DUE_IN
  IN_PREP
  ON_SALE
  SOLD
}

enum CarCondition {
  NEW
  USED
}

enum CarType {
  RETAIL
  TRADE
}

enum ColorOptions {
  BLACK
  BLUE
  BROWN
  GOLD
  GREEN
  GREY
  ORANGE
  PINK
  PURPLE
  RED
  SILVER
  WHITE
  YELLOW
}

enum EngineType {
  PETROL
  DIESEL
  ELECTRIC
  PETROL_HYBRID
  DIESEL_HYBRID
}

enum TransmissionType {
  MANUAL
  AUTOMATIC
  SEMI_AUTOMATIC
}
